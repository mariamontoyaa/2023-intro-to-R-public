<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Data Visualization</title>
    <meta charset="utf-8" />
    <meta name="author" content="Intro to R course" />
    <script src="02_data-visualization_files/header-attrs-2.24/header-attrs.js"></script>
    <link href="02_data-visualization_files/countdown-0.4.0/countdown.css" rel="stylesheet" />
    <script src="02_data-visualization_files/countdown-0.4.0/countdown.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">


&lt;style type="text/css"&gt;
@import url('https://fonts.googleapis.com/css2?family=Bebas+Neue:wght@400;700&amp;display=swap');
pre {
    display: block;
    font-family: monospace;
    white-space: pre;
    margin: 1em 0px;
    margin-top: 0em;
    margin-right: 0px;
    margin-bottom: 0em;
    margin-left: 0px;
    white-space: pre-wrap;
}

p {
    line-height: 22px;
}

h1{
  margin-bottom: -20px;
}

h2{
  margin-bottom: -11px;
}

h3{
  margin-bottom: -10px;
}

.emphasized {
   font-size: 1.2em;
   font-family: Nunito;
}

.greenemph {
   font-size: 1.2em;
   font-family: Nunito;
   color: #69995D
}

.greenhead {
   font-size: 35px;
   font-family: Nunito;
   color: #69995D
}

.nunito {
   font-size: 25px;
   font-family: Nunito;
}

.nunitosm {
   font-family: Nunito;
}
.nunitosmgrey {
   font-family: Nunito;
   color: #E8E9E8
}

.invisible {
   color: white;
}

.remark-code {
background: #green;
}
.remark-slide-number {
  font-size: 10pt;
  margin-bottom: -11.6px;
  margin-right: 10px;
  color: #FFFFFF; /* white */
  opacity: 0; /* default: 0.5 */
}

&lt;/style&gt;










&lt;br&gt;
&lt;br&gt; 
&lt;br&gt; 
&lt;br&gt; 
&lt;br&gt; 
&lt;br&gt; 
&lt;br&gt; 
.center[
# DATA VISUALIZATION
.nunito[LECTURE 2]
.greenhead[INTRO TO R PROGRAMMING]

**MARIA MONTOYA-AGUIRRE**

M1 APE @ PARIS SCHOOL OF ECONOMICS
]


---
# HOMEWORK REVIEW
‚úÖÔ∏èInspect the IMDB dataset `glimpse()` `table()` and describe 5 issues we should solve in the data cleaning/tidying process that we haven‚Äôt addressed in this lecture. Write down the name of at least one function that would help for this. Google if you need! 

- The year variable is not numeric and has string characters. Some functions: `str_length()`, `str_sub()`, `as.numeric()`

‚úÖÔ∏è Are older movies better?

1) Fix the year variable. This can be done in multiple ways! Try with `str_length()` and `str_sub()`

2) Create a variable that indicates whether a movie is older or more recent than the average year in the sample.

3) Create a table with the average rating by decade (start from the 50s).
 
---

## EXERCISE 1 
‚úÖÔ∏èInspect the IMDB dataset `glimpse()` `table()` and describe 5 issues we should solve in the data cleaning/tidying process that we haven‚Äôt addressed in this lecture. Write down the name of at least one function that would help for this. Google if you need! 

--


```r
imdb &lt;- read.csv("../data/01_imdb-top250-french.csv", encoding = "UTF-8")
glimpse(imdb)
```


--

```
## Rows: 250
## Columns: 13
## $ X              &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, ‚Ä¶
## $ Name           &lt;chr&gt; "Shoah", "Home", "Untouchable", "Le Trou", "The Man Who Planted Trees", "Ch‚Ä¶
## $ Rank           &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, ‚Ä¶
## $ Year           &lt;chr&gt; "-1985", "(I) (2009)", "-2011", "-1960", "-1987", "-1945", "-2001", "-2010"‚Ä¶
## $ Type           &lt;chr&gt; "PG", "U", "15", "A", "", "A", "15", "15", "A", "U", "U", "A", "AA", "15", ‚Ä¶
## $ Duration       &lt;chr&gt; "566 min", "118 min", "112 min", "131 min", "30 min", "189 min", "122 min",‚Ä¶
## $ Genre          &lt;chr&gt; "Documentary, History, War", "Documentary", "Biography, Comedy, Drama", "Cr‚Ä¶
## $ Rating         &lt;dbl&gt; 8.7, 8.5, 8.5, 8.5, 8.5, 8.3, 8.3, 8.3, 8.2, 8.2, 8.2, 8.2, 8.1, 8.1, 8.1, ‚Ä¶
## $ MetaScore      &lt;int&gt; 99, 47, 57, NA, NA, 96, 69, 80, NA, NA, NA, 86, 99, NA, NA, 100, 95, 85, 96‚Ä¶
## $ Desc           &lt;chr&gt; "Claude Lanzmann's epic documentary recounts the story of the Holocaust thr‚Ä¶
## $ Director_Stars &lt;chr&gt; "Director:\nClaude Lanzmann\n                 | \n    Stars:\nSimon Srebnik‚Ä¶
## $ Votes          &lt;chr&gt; "9,984", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""‚Ä¶
## $ Gross          &lt;chr&gt; "$0.02M", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "‚Ä¶
```

---
### EXAMPLE

```
## Rows: 250
## Columns: 13
## $ X              &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, ‚Ä¶
## $ Name           &lt;chr&gt; "Shoah", "Home", "Untouchable", "Le Trou", "The Man Who Planted Trees", "Ch‚Ä¶
## $ Rank           &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, ‚Ä¶
*## $ Year           &lt;chr&gt; "-1985", "(I) (2009)", "-2011", "-1960", "-1987", "-1945", "-2001", "-2010"‚Ä¶
## $ Type           &lt;chr&gt; "PG", "U", "15", "A", "", "A", "15", "15", "A", "U", "U", "A", "AA", "15", ‚Ä¶
## $ Duration       &lt;chr&gt; "566 min", "118 min", "112 min", "131 min", "30 min", "189 min", "122 min",‚Ä¶
## $ Genre          &lt;chr&gt; "Documentary, History, War", "Documentary", "Biography, Comedy, Drama", "Cr‚Ä¶
## $ Rating         &lt;dbl&gt; 8.7, 8.5, 8.5, 8.5, 8.5, 8.3, 8.3, 8.3, 8.2, 8.2, 8.2, 8.2, 8.1, 8.1, 8.1, ‚Ä¶
## $ MetaScore      &lt;int&gt; 99, 47, 57, NA, NA, 96, 69, 80, NA, NA, NA, 86, 99, NA, NA, 100, 95, 85, 96‚Ä¶
## $ Desc           &lt;chr&gt; "Claude Lanzmann's epic documentary recounts the story of the Holocaust thr‚Ä¶
## $ Director_Stars &lt;chr&gt; "Director:\nClaude Lanzmann\n                 | \n    Stars:\nSimon Srebnik‚Ä¶
## $ Votes          &lt;chr&gt; "9,984", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""‚Ä¶
## $ Gross          &lt;chr&gt; "$0.02M", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "‚Ä¶
```
--
- The `Year`variable is not numeric and has strings that should not be there "-" "()"

--

 `str_length()`, `str_sub()`, `as.numeric()`
 
---
### 1


```
## Rows: 250
## Columns: 13
## $ X              &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, ‚Ä¶
## $ Name           &lt;chr&gt; "Shoah", "Home", "Untouchable", "Le Trou", "The Man Who Planted Trees", "Ch‚Ä¶
## $ Rank           &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, ‚Ä¶
## $ Year           &lt;chr&gt; "-1985", "(I) (2009)", "-2011", "-1960", "-1987", "-1945", "-2001", "-2010"‚Ä¶
*## $ Type           &lt;chr&gt; "PG", "U", "15", "A", "", "A", "15", "15", "A", "U", "U", "A", "AA", "15", ‚Ä¶
## $ Duration       &lt;chr&gt; "566 min", "118 min", "112 min", "131 min", "30 min", "189 min", "122 min",‚Ä¶
## $ Genre          &lt;chr&gt; "Documentary, History, War", "Documentary", "Biography, Comedy, Drama", "Cr‚Ä¶
## $ Rating         &lt;dbl&gt; 8.7, 8.5, 8.5, 8.5, 8.5, 8.3, 8.3, 8.3, 8.2, 8.2, 8.2, 8.2, 8.1, 8.1, 8.1, ‚Ä¶
## $ MetaScore      &lt;int&gt; 99, 47, 57, NA, NA, 96, 69, 80, NA, NA, NA, 86, 99, NA, NA, 100, 95, 85, 96‚Ä¶
## $ Desc           &lt;chr&gt; "Claude Lanzmann's epic documentary recounts the story of the Holocaust thr‚Ä¶
## $ Director_Stars &lt;chr&gt; "Director:\nClaude Lanzmann\n                 | \n    Stars:\nSimon Srebnik‚Ä¶
## $ Votes          &lt;chr&gt; "9,984", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""‚Ä¶
## $ Gross          &lt;chr&gt; "$0.02M", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "‚Ä¶
```
--

- There are missing values in the `Type` variable that are not coded as missing but are instead only blank `""`. 

--
  `if_else()`, `NA_character_`


---
### 2


```
## Rows: 250
## Columns: 13
## $ X              &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, ‚Ä¶
## $ Name           &lt;chr&gt; "Shoah", "Home", "Untouchable", "Le Trou", "The Man Who Planted Trees", "Ch‚Ä¶
## $ Rank           &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, ‚Ä¶
## $ Year           &lt;chr&gt; "-1985", "(I) (2009)", "-2011", "-1960", "-1987", "-1945", "-2001", "-2010"‚Ä¶
## $ Type           &lt;chr&gt; "PG", "U", "15", "A", "", "A", "15", "15", "A", "U", "U", "A", "AA", "15", ‚Ä¶
## $ Duration       &lt;chr&gt; "566 min", "118 min", "112 min", "131 min", "30 min", "189 min", "122 min",‚Ä¶
*## $ Genre          &lt;chr&gt; "Documentary, History, War", "Documentary", "Biography, Comedy, Drama", "Cr‚Ä¶
## $ Rating         &lt;dbl&gt; 8.7, 8.5, 8.5, 8.5, 8.5, 8.3, 8.3, 8.3, 8.2, 8.2, 8.2, 8.2, 8.1, 8.1, 8.1, ‚Ä¶
## $ MetaScore      &lt;int&gt; 99, 47, 57, NA, NA, 96, 69, 80, NA, NA, NA, 86, 99, NA, NA, 100, 95, 85, 96‚Ä¶
## $ Desc           &lt;chr&gt; "Claude Lanzmann's epic documentary recounts the story of the Holocaust thr‚Ä¶
## $ Director_Stars &lt;chr&gt; "Director:\nClaude Lanzmann\n                 | \n    Stars:\nSimon Srebnik‚Ä¶
## $ Votes          &lt;chr&gt; "9,984", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""‚Ä¶
## $ Gross          &lt;chr&gt; "$0.02M", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "‚Ä¶
```
--

- The `Genre` variable is not useful as it is. It should be categorical variable or a dummy. 
--

`str_detect()`, `case_when()`

---
### 3 &amp; 4


```
## Rows: 250
## Columns: 13
## $ X              &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, ‚Ä¶
## $ Name           &lt;chr&gt; "Shoah", "Home", "Untouchable", "Le Trou", "The Man Who Planted Trees", "Ch‚Ä¶
## $ Rank           &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, ‚Ä¶
## $ Year           &lt;chr&gt; "-1985", "(I) (2009)", "-2011", "-1960", "-1987", "-1945", "-2001", "-2010"‚Ä¶
## $ Type           &lt;chr&gt; "PG", "U", "15", "A", "", "A", "15", "15", "A", "U", "U", "A", "AA", "15", ‚Ä¶
## $ Duration       &lt;chr&gt; "566 min", "118 min", "112 min", "131 min", "30 min", "189 min", "122 min",‚Ä¶
## $ Genre          &lt;chr&gt; "Documentary, History, War", "Documentary", "Biography, Comedy, Drama", "Cr‚Ä¶
## $ Rating         &lt;dbl&gt; 8.7, 8.5, 8.5, 8.5, 8.5, 8.3, 8.3, 8.3, 8.2, 8.2, 8.2, 8.2, 8.1, 8.1, 8.1, ‚Ä¶
## $ MetaScore      &lt;int&gt; 99, 47, 57, NA, NA, 96, 69, 80, NA, NA, NA, 86, 99, NA, NA, 100, 95, 85, 96‚Ä¶
## $ Desc           &lt;chr&gt; "Claude Lanzmann's epic documentary recounts the story of the Holocaust thr‚Ä¶
*## $ Director_Stars &lt;chr&gt; "Director:\nClaude Lanzmann\n                 | \n    Stars:\nSimon Srebnik‚Ä¶
## $ Votes          &lt;chr&gt; "9,984", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""‚Ä¶
## $ Gross          &lt;chr&gt; "$0.02M", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "‚Ä¶
```
--


```
## [1] "Director:\nClaude Lanzmann\n                 | \n    Stars:\nSimon Srebnik, \nMichael Podchlebnik, \nMotke Za√Ødl, \nHanna Za√Ødl"
```
--
- The variable `Director_Stars` stores two variables in one column, it should be split

--

`separate_wider_delim()` 

--

- The variable Director_Stars should not have the variable name in the content 
--

   `gsub()`, `str_remove()`

---
### 5


```
## Rows: 250
## Columns: 13
## $ X              &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, ‚Ä¶
## $ Name           &lt;chr&gt; "Shoah", "Home", "Untouchable", "Le Trou", "The Man Who‚Ä¶
## $ Rank           &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, ‚Ä¶
## $ Year           &lt;chr&gt; "-1985", "(I) (2009)", "-2011", "-1960", "-1987", "-194‚Ä¶
## $ Type           &lt;chr&gt; "PG", "U", "15", "A", "", "A", "15", "15", "A", "U", "U‚Ä¶
## $ Duration       &lt;chr&gt; "566 min", "118 min", "112 min", "131 min", "30 min", "‚Ä¶
## $ Genre          &lt;chr&gt; "Documentary, History, War", "Documentary", "Biography,‚Ä¶
## $ Rating         &lt;dbl&gt; 8.7, 8.5, 8.5, 8.5, 8.5, 8.3, 8.3, 8.3, 8.2, 8.2, 8.2, ‚Ä¶
## $ MetaScore      &lt;int&gt; 99, 47, 57, NA, NA, 96, 69, 80, NA, NA, NA, 86, 99, NA,‚Ä¶
## $ Desc           &lt;chr&gt; "Claude Lanzmann's epic documentary recounts the story ‚Ä¶
## $ Director_Stars &lt;chr&gt; "Director:\nClaude Lanzmann\n                 | \n    S‚Ä¶
*## $ Votes          &lt;chr&gt; "9,984", "", "", "", "", "", "", "", "", "", "", "", ""‚Ä¶
*## $ Gross          &lt;chr&gt; "$0.02M", "", "", "", "", "", "", "", "", "", "", "", "‚Ä¶
```

- All the values in the `Gross` and `Votes` variables are missing   

`select()` 
---


## EXERCISE 2
1) Fix the year variable. This can be done in multiple ways! Try with `str_length()` and `str_sub()`


```r
  imdb$Year[1:50]
```

```
##  [1] "-1985"      "(I) (2009)" "-2011"      "-1960"      "-1987"     
##  [6] "-1945"      "-2001"      "-2010"      "-1962"      "-1956"     
## [11] "-1902"      "-1969"      "-1969"      "-1995"      "-1959"     
## [16] "-1994"      "-2019"      "-1953"      "-1966"      "(I) (2014)"
## [21] "-1928"      "-1967"      "-1937"      "-1955"      "-2007"     
## [26] "-2007"      "-1955"      "-1952"      "-1987"      "-1962"     
## [31] "-1939"      "-1986"      "-1970"      "-1958"      "-1986"     
## [36] "-1973"      "-1983"      "-1966"      "-1950"      "-1953"     
## [41] "-1963"      "-1966"      "-1973"      "(I) (2011)" "-2009"     
## [46] "-2012"      "-1993"      "-1960"      "-2004"      "-1972"
```
--
- There are two formats: `-YYYY` and `(I) (YYYY)`. We need to keep only the `YYYY` part to convert it to numeric.
- What do `str_length()` and `str_sub()` do? 
 
---
1) Fix the year variable. This can be done in multiple ways! Try with `str_length()` and `str_sub()`

2) Create a variable that indicates whether a movie is older or more recent than the average year in the sample.


```r
  imdb &lt;-
    imdb %&gt;% 
    # Fix year variable 
    mutate(year = if_else(str_length(Year) == 5,   # If format is "-YYYY",
                          str_sub(Year, 2, 5),     #  extract positions 2-5
                          str_sub(Year, 6, 9)),    #  otherwise it's "(I) (YYYY)"  
                                                   #  so, keep positions 6-9
           year = as.numeric(year)) %&gt;%            # Convert to numeric
  

  
  
  
  
  
 # 
```
---

1) Fix the year variable. This can be done in multiple ways! Try with `str_length()` and `str_sub()`

2) Create a variable that indicates whether a movie is older or more recent than the average year in the sample.


```r
  imdb &lt;-
    imdb %&gt;% 
    # Fix year variable 
    mutate(year = if_else(str_length(Year) == 5,   # If format is "-YYYY",
                          str_sub(Year, 2, 5),     #  extract positions 2-5
                          str_sub(Year, 6, 9)),    #  otherwise it's "(I) (YYYY)"  
                                                   #  so, keep positions 6-9
           year = as.numeric(year)) %&gt;%            # Convert to numeric
  
    # Create an "older than average" indicator 
    mutate(avg_year = mean(year),                  # Calculate average year
           older_than_avg = year &lt; avg_year) %&gt;%   # Create indicator 
    select(Name, year, avg_year, older_than_avg, Rating )

  head(imdb)
```
--


---
### OTHER WAYS TO FIX YEAR FROM YOUR ANSWERS
&lt;br&gt;

Using **regular expressions**, a concise language for describing patterns strings. See a [cheatsheet on how to use them with package {stringr} here](https://github.com/rstudio/cheatsheets/blob/main/strings.pdf). 

```r
imdb %&gt;% 
  mutate(Year = ...)

str_extract(Year,"[:digit:]{4}") # Extract exactly 4 digits
str_replace_all(Year, "[()I-]", "") # Replace the characters ()I- for nothing
- gsub("[^0-9.]+", "", Year)  # Replace anything that is not 0-9 (one or more)
```


---
3) Create a table with the average rating by decade (start from the 50s).
--

```r
  imdb %&gt;% 
    # Create decade indicator 
    mutate(decade = case_when(year %in% c(1950:1959) ~ "50s",
                              year %in% c(1960:1969) ~ "60s",
                              year %in% c(1970:1979) ~ "70s",
                              year %in% c(1980:1989) ~ "80s",
                              year %in% c(1990:1999) ~ "90s",
                              year %in% c(2000:2009) ~ "2000s",
                              year %in% c(2010:2019) ~ "2010s",
                              year %in% c(2019:2029) ~ "2020s",
                              .default = "40s or older")) %&gt;% 
    


  
  
  #
```



---

3) Create a table with the average rating by decade (start from the 50s).

```r
  imdb %&gt;% 
    # Create decade indicator 
    mutate(decade = case_when(year %in% c(1950:1959) ~ "50s",
                              year %in% c(1960:1969) ~ "60s",
                              year %in% c(1970:1979) ~ "70s",
                              year %in% c(1980:1989) ~ "80s",
                              year %in% c(1990:1999) ~ "90s",
                              year %in% c(2000:2009) ~ "2000s",
                              year %in% c(2010:2019) ~ "2010s",
                              year %in% c(2019:2029) ~ "2020s",
                              .default = "40s or older")) %&gt;% 
    
    # Create a table with average rating by decade 
    group_by(decade) %&gt;% 
    summarise(avg_rating = mean(Rating))
#
```
--

---


&lt;!-- Full --&gt; 

3) Create a table with the average rating by decade (start from the 50s).

```r
  imdb %&gt;% 
    # Create decade indicator 
    mutate(decade = case_when(year %in% c(1950:1959) ~ "50s",
                              year %in% c(1960:1969) ~ "60s",
                              year %in% c(1970:1979) ~ "70s",
                              year %in% c(1980:1989) ~ "80s",
                              year %in% c(1990:1999) ~ "90s",
                              year %in% c(2000:2009) ~ "2000s",
                              year %in% c(2010:2019) ~ "2010s",
                              year %in% c(2019:2029) ~ "2020s",
                              .default = "40s or older")) %&gt;% 
    
    # Create a table with average rating by decade 
    group_by(decade) %&gt;% 
    summarise(avg_rating = mean(Rating)) %&gt;% 
*   arrange(-avg_rating)
```

---
### OTHER WAYS TO CREATE THE DECADE FROM YOUR ANSWERS
&lt;br&gt;


```r
imdb %&gt;% 
  mutate(decade = ...)

paste(str_sub(Year, start = 3, end = 3),"0s", sep="") # Get the third string, and add "0s"

as.numeric(substr(Year, start = 1, stop=3)) * 10 # Get first three digits of year and multiply by 10 

floor(Year/10) * 10 # Divide the year by 10 and round downwards

Year %/% 10 * 10 # Integer division, get the quotient 
```
---
class: inverse
# WARM-UP USING {dplyr}
&lt;br&gt; 
- Import `02_taylor-swift-spotify.csv` (originally obtained [here](https://www.kaggle.com/datasets/jarredpriester/taylor-swift-spotify-dataset?resource=download)) and `View()` the data 

- Inspect the structure of the data using `glimpse()`

- Use `summarise()` to compute for each album the average danceability and the the number of songs included (1 row per song)

- Create a subset of the data called `maxpop`containing the variables `album`, `release_date`, `danceability` and `popularity` for the 10 most popular songs. Use function `arrange()` and `row_number()`
<div class="countdown" id="timer_6158b53b" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
---
### WARM-UP 



- Import `02_taylor-swift-spotify.csv` (originally obtained [here](https://www.kaggle.com/datasets/jarredpriester/taylor-swift-spotify-dataset?resource=download)) and `View()` the data 
- Inspect the structure of the data using `glimpse()`

--

```r
ts &lt;- read.csv("../data/02_taylor-swift-spotify.csv")

glimpse(ts)
```

```
## Rows: 487
## Columns: 21
## $ X                  &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, ‚Ä¶
## $ name               &lt;chr&gt; "Mine (Taylor's Version)", "Sparks Fly (Taylor‚Äôs Ve‚Ä¶
## $ album              &lt;chr&gt; "Speak Now", "Speak Now", "Speak Now", "Speak Now",‚Ä¶
## $ release_date       &lt;chr&gt; "2023-07-07", "2023-07-07", "2023-07-07", "2023-07-‚Ä¶
## $ track_number       &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, ‚Ä¶
## $ id                 &lt;chr&gt; "7G0gBu6nLdhFDPRLc0HdDG", "3MytWN8L7shNYzGl4tAKRp",‚Ä¶
## $ uri                &lt;chr&gt; "spotify:track:7G0gBu6nLdhFDPRLc0HdDG", "spotify:tr‚Ä¶
## $ acousticness       &lt;dbl&gt; 0.004440, 0.025100, 0.006210, 0.248000, 0.023600, 0‚Ä¶
....
```
---
### WARM-UP
- Use `summarise()` to compute for each album the average danceability and the the number of songs included (1 row per song)
--

```r
ts %&gt;% 
  group_by(album) %&gt;% 
  summarise(avg_danceability = mean(danceability),
            songs = n())
```
---
### WARM-UP
- Create a subset of the data called `maxpop`containing the variables `album`, `release_date`, `danceability` and `popularity` for the 10 most popular songs. Use function `arrange()` and `row_number()`
--


```r
maxpop &lt;-
  ts %&gt;% 
  arrange(-popularity) %&gt;%          # Order by popularity (descending)
  select(album, release_date, danceability, popularity) %&gt;% 
  filter(row_number() &lt;= 10)        # Keep first 10 rows 

maxpop
```

---
# AGENDA
.nunitosm[

.pull-left[
.nunitosmgrey[]
- AN INTRO TO DATA VISUALIZATION

- THE ggplot() FUNCTION
  1. MAIN STRUCTURE
  2. AESTHETICS 
  3. ADDING DIMENSIONS
  4. MAPPING vs. SETTING ATTRIBUTES
  5. SAVING

]

.pull-right[

- BROWSING THE TOOLBOX
  1. LABELS
  2. ANNOTATIONS
  3. ADDING LAYERS
  4. GROUPING DATA
  5. STATISTICAL SUMMARIES
  
- WHICH GRAPH SHOULD I USE?
- GRAPHICAL EXCELLENCE AND INTEGRITY

]
 ]

---
# DATA VISUALIZATION

First known graphics applied to economic data were produced by William Playfair (1759-1823), a Scottish political economist in his book *The Commercial and Political Atlas* &lt;sup&gt;1&lt;/sup&gt;

&lt;img src="inputs/playfair-trade-balance.png" width="60%" style="display: block; margin: auto;" /&gt;

.footnote[ [1]Tilling, 1975 as cited in Tufte, 2007. ]


---

class: middle

&gt; Information, that is imperfectly acquired, is generally imperfectly retained;
&gt; and a man (*person*) who has carefully investigated **a printed table**, finds, when done, that (s)he has **only a very faint and partial idea** of what (s)he has read; and that like a figure imprinted on sand, is **soon totally erased and defaced**. [...] 

&gt; On **inspecting any one of these Charts** attentively, a **sufficiently distinct impression** will be made, to **remain unimpaired for a considerable time**, and the idea which does remain will be **simple and complete** [...] 
&gt; &lt;footer&gt;--- William Playfair in The Commercial and Political Atlas&lt;/footer&gt;



---

class: middle

&lt;img src="inputs/marey-trains-paris-lyon.png" width="80%" style="display: block; margin: auto;" /&gt;



---
&lt;br&gt;
&lt;br&gt;
.center[
## Now, using R with the {ggplot2} package and the current Paris - Marseille schedule
] 
---
class: middle

&lt;img src="inputs/marey-trains-paris-marseille.png" width="80%" style="display: block; margin: auto;" /&gt;


---

class: middle

&lt;img src="inputs/marey-trains-paris-marseille-traincol.png" width="80%" style="display: block; margin: auto;" /&gt;




---

class: middle

&lt;img src="inputs/marey-trains-paris-marseille-dircol.png" width="80%" style="display: block; margin: auto;" /&gt;


---


class: middle

&lt;img src="inputs/marey-trains-paris-marseille-direct.png" width="80%" style="display: block; margin: auto;" /&gt;


---
class: middle

&lt;img src="inputs/marey-trains-paris-marseille-layover.png" width="80%" style="display: block; margin: auto;" /&gt;


---
&lt;img src="https://cdn.myportfolio.com/45214904-6a61-4e23-98d6-b140f8654a40/9a306c0a-dac8-413d-ba2e-cc7fd4c4d5c8_rw_1920.png?h=c802991088a9623f1f7aa18c470797ee" width="80%" style="display: block; margin: auto;" /&gt;


---
## PREPARING THE DATA FOR TODAY
We are going to use data from the [World Inequality Database](https://wid.world/).


```r
wid &lt;- read.csv("../data/02_wid.csv")
glimpse(wid)
```

```
## Rows: 1,610
## Columns: 6
## $ country   &lt;chr&gt; "Algeria", "Algeria", "Algeria", "Algeria", "Algeria", "Alge‚Ä¶
## $ continent &lt;chr&gt; "Africa", "Africa", "Africa", "Africa", "Africa", "Africa", ‚Ä¶
## $ year      &lt;int&gt; 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, ‚Ä¶
## $ fshare    &lt;dbl&gt; 0.0992, 0.1120, 0.1201, 0.1206, 0.1160, 0.1221, 0.1232, 0.12‚Ä¶
## $ top1      &lt;dbl&gt; 0.1003, 0.0991, 0.0991, 0.0991, 0.0991, 0.0991, 0.0991, 0.09‚Ä¶
## $ inc_head  &lt;dbl&gt; 12610.627, 12619.984, 12634.026, 12531.988, 12546.430, 12533‚Ä¶
```

**What is the observation level? **
--
Country-year 
--
 
Variables:
- `fshare` Female labor income share
- `top1` Top 1% income share
- `inc_head` Income per capita (adults)


---
# ggplot() BASICS
.pull-left[
Based on *The Grammar of graphics* (Wilkinson, 2005).&lt;br&gt; What is a statistical graphic? A mapping from data to aesthetic attributes (color, shape, size) of geometric objects (points, lines, bars). 

  `ggplot()` creates a canvas to draw on. 

]
.pull-right[

```r
#install.packages("ggplot2")
library(ggplot2)
```

```r
ggplot()
```

![](02_data-visualization_files/figure-html/unnamed-chunk-38-1.png)&lt;!-- --&gt;
]

---


---
# ggplot() BASICS
.pull-left[
Based on *The Grammar of graphics* (Wilkinson, 2005). &lt;br&gt; What is a statistical graphic? A mapping from data to aesthetic attributes (color, shape, size) of geometric objects (points, lines, bars). 

  `ggplot()` creates a canvas to draw on. Then we add: 

&lt;span class="emphasized"&gt;üî¢ üî° Data:&lt;/span&gt; specifies the dataframe with the **values** to plot
 



]
.pull-right[

```r
#install.packages("ggplot2")
library(ggplot2)
```


```r
ggplot(data = wid,          # Data
```

![](02_data-visualization_files/figure-html/unnamed-chunk-41-1.png)&lt;!-- --&gt;

]

---
# ggplot() BASICS
.pull-left[
Based on *The Grammar of graphics* (Wilkinson, 2005). &lt;br&gt; What is a statistical graphic? A mapping from data to aesthetic attributes (color, shape, size) of geometric objects (points, lines, bars). 

  `ggplot()` creates a canvas to draw on. Then we add: 

&lt;span class="emphasized"&gt;üî¢ üî° Data:&lt;/span&gt; specifies the dataframe with the **values** to plot
 

&lt;span class="emphasized"&gt;üìê üñåÔ∏èAesthetic mappings:&lt;/span &gt; relate variables in the data to visual characteristics of the plot. 


]
.pull-right[

```r
#install.packages("ggplot2")
library(ggplot2)
```


```r
ggplot(data = wid,          # Data
       aes(x = inc_head,    # Aesthetics
           y = top1)) +
```

![](02_data-visualization_files/figure-html/unnamed-chunk-44-1.png)&lt;!-- --&gt;

]

---

# ggplot() BASICS
.pull-left[
Based on *The Grammar of graphics* (Wilkinson, 2005). &lt;br&gt; What is a statistical graphic? A mapping from data to aesthetic attributes (color, shape, size) of geometric objects (points, lines, bars). 

  `ggplot()` creates a canvas to draw on. Then we add: 

&lt;span class="emphasized"&gt;üî¢ üî° Data:&lt;/span&gt; specifies the dataframe with the **values** to plot
 

&lt;span class="emphasized"&gt;üìê üñåÔ∏èAesthetic mappings:&lt;/span &gt; relate variables in the data to visual characteristics of the plot. 


&lt;span class="emphasized"&gt;üìà üìä Geometries:&lt;/span&gt; describe how to render each observation. Can be layered to have multiple representations of the data.  
 


]
.pull-right[

```r
#install.packages("ggplot2")
library(ggplot2)
```


```r
ggplot(data = wid,          # Data
       aes(x = inc_head,    # Aesthetics
           y = top1)) +
  geom_point()              # Geometry
```

![](02_data-visualization_files/figure-html/unnamed-chunk-46-1.png)&lt;!-- --&gt;

]

---


# ggplot() BASICS
.pull-left[
Based on *The Grammar of graphics* (Wilkinson, 2005). &lt;br&gt; What is a statistical graphic? A mapping from data to aesthetic attributes (color, shape, size) of geometric objects (points, lines, bars). 

  `ggplot()` creates a canvas to draw on. Then we add: 

&lt;span class="emphasized"&gt;üî¢ üî° Data:&lt;/span&gt; specifies the dataframe with the **values** to plot
 

&lt;span class="emphasized"&gt;üìê üñåÔ∏èAesthetic mappings:&lt;/span &gt; relate variables in the data to visual characteristics of the plot. 


&lt;span class="emphasized"&gt;üìà üìä Geometries:&lt;/span&gt; describe how to render each observation. Can be layered to have multiple representations of the data.  
 


]
.pull-right[

```r
#install.packages("ggplot2")
library(ggplot2)
```


```r
ggplot(data = wid,          # Data
       aes(x = inc_head,    # Aesthetics
           y = top1)) +
  geom_point()              # Geometry
```

![](02_data-visualization_files/figure-html/unnamed-chunk-48-1.png)&lt;!-- --&gt;

]

---
## MAIN STRUCTURE

- Data and mapping should be specified in parentheses
- The first two arguments in `aes()` are almost always x,y 
- Geometry and other elements should be added with `+` 

```r
ggplot(wid, 
       aes(inc_head, top1)) +  
  geom_point()
```
--
&lt;span class="emphasized"&gt; Remember the pipe? &lt;/span&gt; 
- We can also apply `ggplot()` to our data with the pipe `%&gt;%` OR `|&gt;`
--


```r
wid %&gt;%                     # Data
ggplot(aes(x = inc_head,    # Aesthetics
           y = top1)) +
  geom_point()              # Geometry
```
---



### Can you guess the plots?

```r
wid %&gt;% 
  ggplot(aes(top1, inc_head)) +
  geom_point()
```
--

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-52-1.png" style="display: block; margin: auto;" /&gt;
---
### Can you guess the plots?


```r
wid %&gt;% 
  ggplot(aes(inc_head, fshare)) +
  geom_point()
```
--

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-54-1.png" style="display: block; margin: auto;" /&gt;
---
### Can you guess the plots?


```r
wid %&gt;% 
  filter(country == "Italy") %&gt;% 
  ggplot(aes(year, fshare)) +
  geom_line()
```
--

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-56-1.png" style="display: block; margin: auto;" /&gt;
---
### Can you guess the plots?


```r
wid %&gt;% 
  filter(year == "2010") %&gt;% 
  ggplot(aes(inc_head)) +
  geom_histogram()
```
--


```
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
```

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-58-1.png" style="display: block; margin: auto;" /&gt;
---
# AESTHETICS:
.greenhead[**AXES**]
The quickest functions for the most common modifications:
.pull-left[


```r
wid %&gt;% 
  ggplot(aes(inc_head, top1)) +
  geom_point() +
* xlab("Income per adult") +
* ylab("Income share among top 1%") +
* xlim(0.2, 0.3)
```

![](02_data-visualization_files/figure-html/unnamed-chunk-60-1.png)&lt;!-- --&gt;
]
.pull-right[

```r
wid %&gt;% 
  ggplot(aes(inc_head, top1)) +
  geom_point() +
* xlab(NULL) +
* ylab("") +
* ylim(NA, 50000)
```

![](02_data-visualization_files/figure-html/unnamed-chunk-62-1.png)&lt;!-- --&gt;
]

---
# AESTHETICS
.greenhead[**THEME**]
- The theme system allows you to have control over the appearance of all the **non-data** elements of the plot
- You can use any of the **default R themes**. Also, you can specify the **font size** using `base_size` 


```r
... +
  theme_gray(base_size = 10) #&lt;&lt; # The default theme 
```

--

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-64-1.png" width="25%" /&gt;&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-64-2.png" width="25%" /&gt;&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-64-3.png" width="25%" /&gt;&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-64-4.png" width="25%" /&gt;
--

- You can customize the graph completely using the theme() function
- See `?theme` for the endless possibilities and [Chapter 8 of Wickham (2016)](https://ggplot2-book.org/themes)


  
---
# AESTHETICS .greenhead[**GEOM ATTRIBUTES**] 

We can set the appearance of our observations by specifying their shape, color, fill, size/width, and transparency (*alpha*). 
**Aesthetic attributes can make or break a plot:** 

```r
df &lt;- data.frame(x = rnorm(15000), y = rnorm(15000))
norm &lt;-
  df %&gt;% 
  ggplot(aes(x,y)) 

norm + geom_point()
```

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-66-1.png" width="28%" style="display: block; margin: auto;" /&gt;
---
### How to deal with overplotting? 

&lt;span class="emphasized"&gt;Changing the size&lt;/span&gt;


```r
par(mar = c(3, 3, .1, .1))

norm + geom_point(size = 3)
norm + geom_point(size = 2)
norm + geom_point(size = 1)
```

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-67-1.png" width="33%" /&gt;&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-67-2.png" width="33%" /&gt;&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-67-3.png" width="33%" /&gt;
---

### How to deal with overplotting? 
&lt;span class="emphasized"&gt;Changing the shape&lt;/span&gt;

```r
par(mar = c(3, 3, .1, .1))

norm + geom_point(size =3)
norm + geom_point(size = 3,
*                 shape = 1)
norm + geom_point(size = 3,
*                 shape = "X")
```

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-68-1.png" width="33%" /&gt;&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-68-2.png" width="33%" /&gt;&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-68-3.png" width="33%" /&gt;
See `vignette("ggplot2-specs")`for the values you can use for these and other aesthetics

---

### How to deal with overplotting? 

&lt;span class="emphasized"&gt;Changing the transparency&lt;/span&gt;


```r
par(mar = c(3, 3, .1, .1))

norm + geom_point(size = 3)
norm + geom_point(size = 3,
*                 alpha = 1 / 2)
norm + geom_point(size = 3,
*                 alpha = 0.1)
```

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-69-1.png" width="33%" /&gt;&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-69-2.png" width="33%" /&gt;&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-69-3.png" width="33%" /&gt;



---

## ADDING DIMENSIONS
So far, we've added at most two variables to our plots. 

We can add more variables using aesthetics like the **color, shape, and size** of the geometries. 
.pull-left[


```r
wid %&gt;% 
  ggplot(aes(inc_head, top1,
*            color = continent)) +
  geom_point()
```

![](02_data-visualization_files/figure-html/unnamed-chunk-71-1.png)&lt;!-- --&gt;
]
.pull-right[
]
---

## ADDING DIMENSIONS
So far, we've added at most two variables to our plots. 

We can add more variables using aesthetics like the **color, shape, and size** of the geometries. We are **mapping** variable values into visual attributes. 
.pull-left[


```r
wid %&gt;% 
  ggplot(aes(inc_head, top1,
*            color = continent)) +
  geom_point()
```

![](02_data-visualization_files/figure-html/unnamed-chunk-73-1.png)&lt;!-- --&gt;
]
.pull-right[
- ggplot2 takes care of the details converting data ("Europe", "Africa") to aesthetics (Green, Red) with an automatic **scale** 

- When our mapping variable is continuous, a gradient is used instead

- The scale can be overridden and customized. [See Chapter 6 of ggplot2 book for more details.  ](https://ggplot2-book.org/scales-colour)
  - `scale_color_discrete()`
  - `scale_color_manual(values = c("red", "blue","#000000"))`

]
---
## ADDING DIMENSIONS


```r
wid %&gt;% 
  ggplot(aes(inc_head, top1,
*            color = fshare)) +
  geom_point(alpha = 0.3)
```
&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-75-1.png" style="display: block; margin: auto;" /&gt;

---
##Setting vs. mapping visual attributes
.pull-left[
.nunito[**Setting:**] Defining a **fixed** value

```r
wid %&gt;% 
  ggplot(aes(inc_head, top1)) +
  geom_point(color = "darkblue")
```
![](02_data-visualization_files/figure-html/unnamed-chunk-77-1.png)&lt;!-- --&gt;
]
.pull-right[
.nunito[**Mapping:**] Relating an aesthetic to a **variable**  


```r
wid %&gt;% 
  ggplot(aes(inc_head, top1,
*            color = continent)) +
  geom_point()
```


```r
# Equivalent to this: 
wid %&gt;% 
  ggplot(aes(inc_head, top1)) +
* geom_point(aes(color = continent))
```
![](02_data-visualization_files/figure-html/unnamed-chunk-80-1.png)&lt;!-- --&gt;
]
---
### What about this? 

.pull-left[
&lt;br&gt; 

```r
wid %&gt;% 
  ggplot(aes(inc_head, top1)) +
* geom_point(aes(color = "darkblue"))
```

![](02_data-visualization_files/figure-html/unnamed-chunk-82-1.png)&lt;!-- --&gt;

]

.pull-left[
]

---

### What about this? 

.pull-left[
&lt;br&gt; 

```r
wid %&gt;% 
  ggplot(aes(inc_head, top1)) +
* geom_point(aes(color = "darkblue"))
```

![](02_data-visualization_files/figure-html/unnamed-chunk-84-1.png)&lt;!-- --&gt;

]

.pull-left[
- This is mapping the value "dark blue" to a color.

- It temporarily creates a new variable containing only the value "darkblue" and then scales it with a color scale.



```r
wid %&gt;% 
  mutate(colour = "darkblue") %&gt;% 
  ggplot(aes(inc_head, top1,
             color = colour)) +
  geom_point() 
```

- We'll learn how it can be useful in a few slides

]

---
### FACETTING


.pull-left[
- Another technique for displaying additional categorical variables on a plot is facetting.


```r
wid %&gt;% 
  ggplot(aes(inc_head, top1)) +
  geom_point(alpha = 0.3) +
  facet_wrap(~continent)
```
- It creates tables of plots by splitting the data into subsets and displaying different graphs for each subset

]
.pull-right[

![](02_data-visualization_files/figure-html/unnamed-chunk-87-1.png)&lt;!-- --&gt;
]


---
### FACETTING


.pull-left[
- Another technique for displaying additional categorical variables on a plot is facetting.


```r
wid %&gt;% 
  ggplot(aes(inc_head, top1)) +
  geom_point(alpha = 0.3) +
  facet_wrap(~continent)
```
- It creates tables of plots by splitting the data into subsets and displaying different graphs for each subset

- Choose the facet arrangement using `nrow` and `ncol` to indicate the number of rows and columns
- Specify the type of scale you want:
  - **free**: adjusted separately to each facet
  - **fixed**: common to all 
]
.pull-right[

![](02_data-visualization_files/figure-html/unnamed-chunk-89-1.png)&lt;!-- --&gt;
]


---
### FACETTING


```r
wid %&gt;% 
  ggplot(aes(inc_head, top1)) +
  geom_point(alpha = 0.3) +
  facet_wrap(~continent,
*            ncol = 6,
*            scales = "free_x")
```
![](02_data-visualization_files/figure-html/unnamed-chunk-91-1.png)&lt;!-- --&gt;
---
&lt;br&gt;
&lt;br&gt;
## SAVING 
- `ggsave()` will save what is in the plot panel


```r
ggsave("../myplot.png")   # Saves what is in the Plots tab

ggsave("../myplot.png",    # Where 
       plot = last_plot(), # What 
       width = 16,         # Dimensions
       height = 9,
       unit = "cm")        # Units
```
---
# AGENDA
.nunitosm[

.pull-left[
.nunitosmgrey[
- AN INTRO TO DATA VISUALIZATION

- THE ggplot() FUNCTION
  1. MAIN STRUCTURE
  2. AESTHETICS 
  3. ADDING DIMENSIONS
  4. MAPPING vs. SETTING ATTRIBUTES
  5. SAVING
]
]

.pull-right[

- BROWSING THE TOOLBOX
  1. ADDING LAYERS
  2. LABELS
  3. ANNOTATIONS
  4. GROUPING DATA
  5. STATISTICAL SUMMARIES
  
- WHICH GRAPH SHOULD I USE?
- GRAPHICAL EXCELLENCE AND INTEGRITY

]
 ]
---

### BROWSING THE TOOLBOX
There is a lot. Really **A LOT** you can do with ggplot. 
&lt;br&gt; Let's illustrate these tools creating a `ggplot()` modern version of one of Playfair's trade balance graphs: &lt;br&gt; - Download and import `02_playfair-balance.csv`

&lt;img src="inputs/02_playfair-trade-balance-nordic.png" width="65%" style="display: block; margin: auto;" /&gt;

---
### ADDING MORE LAYERS
.pull-left[
We can keep on adding geometries and geometries to build our dataset.
- Every layer we add must have some data associated with it 
- The data on each layer doesn't need to be the same. We can specify the mappings/aesthetics of each geom (data, x, y) separately. 
  - When a new geom is added it inherits the aesthetics inside `ggplot(aes())` unless specified otherwise
  - It doesn't hurt to be explicit about which data you are using when you are handling multiple layers    
]
 
.pull-right[

```r
balance &lt;- read.csv("../data/raw/02_playfair-balance.csv") 
```


```r
balance %&gt;% 
  ggplot(aes(x = year, y = exports)) + 
* geom_line(aes(y = exports),      # First layer
            color = "red") +
* geom_line(aes(y = imports),      # Second layer
            color = "orange") + 
  theme_minimal(base_size = 20) 
```

![](02_data-visualization_files/figure-html/unnamed-chunk-95-1.png)&lt;!-- --&gt;
]


---


```r
balance %&gt;% 
  ggplot(aes(x = year, y = exports)) + 
* geom_line(aes(y = exports),      # First layer
            color = "red") +
  theme_minimal(base_size = 20) 
```

![](02_data-visualization_files/figure-html/unnamed-chunk-96-1.png)&lt;!-- --&gt;
---


```r
balance %&gt;% 
  ggplot(aes(x = year, y = exports)) + 
* geom_line(aes(y = exports),      # First layer
            color = "red") +
* geom_line(aes(y = imports),      # Second layer
            color = "gold") + 
  theme_minimal(base_size = 20) 
```

![](02_data-visualization_files/figure-html/unnamed-chunk-97-1.png)&lt;!-- --&gt;
---

.nunito[What happens if we don't specify new mappings for each geom?]

```r
balance %&gt;% 
  ggplot(aes(x = year, y = exports)) + 
  geom_line(color = "red") +
  geom_line(color = "gold") + 
  theme_minimal(base_size = 20) 
```

![](02_data-visualization_files/figure-html/unnamed-chunk-98-1.png)&lt;!-- --&gt;
---
### LABELING EACH LAYER

```r
  balance %&gt;% 
    ggplot(aes(x = year, y = exports)) + 
    geom_line(aes(y = exports,
*                 color = "Exports")) +
    geom_line(aes(y = imports,
*                 color = "Imports")) +
    theme_minimal() +
  scale_color_manual(values = c("red", "orange"),
                     name = NULL)
```

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-99-1.png" style="display: block; margin: auto;" /&gt;
---


Let's save this plot to add more things to it later: 

```r
*balance_plot &lt;-
  balance %&gt;% 
    ggplot(aes(x = year, y = exports)) + 
    geom_line(aes(y = exports,
                  color = "Exports")) +   
    geom_line(aes(y = imports,
                  color = "Imports")) +     
    theme_minimal() +
  scale_color_manual(values = c("red", "orange"),
                     name = NULL)
```
---

## LABELS

- Adding text to a plot. Your obvious best friend: `geom_text()`. Same as `geom_point()`but with text labels instead of points. Duh üôÑ

For example, with our WID data:

```r
wid %&gt;% 
  filter(year == 2019 &amp; continent == "Europe") %&gt;% 
  ggplot(aes(x = inc_head, y = top1)) +
* geom_text(aes(label = country),
            alpha = 0.7)
```


![](02_data-visualization_files/figure-html/unnamed-chunk-102-1.png)&lt;!-- --&gt;
---


### LABELS 
Now, using it with our trade balance plot to highlight three points:

```r
bal_labels &lt;- # Keep only the data for three years 
  balance %&gt;% 
  filter(year %in% c(1702, 1740, 1764)) 
```
--

```r
balance_plot + 
* geom_point(data = bal_labels) +
  geom_text(aes(x = year, y = exports,
                label = exports), 
*           data = bal_labels)
```
&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-105-1.png" style="display: block; margin: auto;" /&gt;


---


Fixing things:

```r
bal_labels &lt;- 
  balance %&gt;% 
  filter(year %in% c(1702, 1740, 1764)) # Keep only these
```

```r
balance_plot + 
  geom_point(data = bal_labels) + 
  geom_text(aes(x = year, y = exports,
                label = exports), 
            data = bal_labels, 
*           nudge_y = 4,
*           nudge_x = -2)
```
&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-108-1.png" style="display: block; margin: auto;" /&gt;

---
### ANNOTATIONS
- Annotations add metadata to your plot to **highlight** certain features. You can use:

  - `geom_text()` to add text descriptions or label points (ex. outliers). 
  
  - `geom_rect()` to highlight rectangular regions of the plot
  
  - `geom_line()`, `geom_path()`, `geom_segment()` to add lines 
  
  - `geom_vline()`, `geom_hline()` to add rulers (lines that span the whole graph)
  
---
### ANNOTATIONS
.pull-left[


```r
balance_plot +
  geom_vline(xintercept = 1707,
             linetype = "dashed") 
```
&lt;br&gt;
&lt;br&gt;
![](02_data-visualization_files/figure-html/unnamed-chunk-110-1.png)&lt;!-- --&gt;
]
.pull.right[


```r
balance_plot +
  geom_vline(xintercept = 1707,
             linetype = "dashed") +
  annotate("text", x = 1716, y = 150, 
           label = "Acts of Union between \n England and Scotland")
```

![](02_data-visualization_files/figure-html/unnamed-chunk-112-1.png)&lt;!-- --&gt;
] 
---
class: inverse
### EXERCISE 

- Reproduce this graph with the Taylor Swift data.  Hint: add `scale_shape_manual(values = c(1, 16))` at the end. 
&lt;br&gt; 
&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-113-1.png" width="1080" /&gt;
<div class="countdown" id="timer_b53467aa" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>




---

```r
ts %&gt;% 
  ggplot(aes(x = popularity, y = album))
```

```r
                                                                                  #
                                                                                  #
                                                                                  #
                                                                                  #
                                                                                  #
                                                                                  #
                                                                                  #
```

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-115-1.png" width="1080" /&gt;

---

```r
ts %&gt;% 
  ggplot(aes(x = popularity, y = album)) + 
  geom_point(size = 6) 
```

```r
                                                                                  #
                                                                                  #
                                                                                  #
                                                                                  #
                                                                                  #
                                                                                  #
```

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-117-1.png" width="1080" /&gt;
---





```r
ts %&gt;% 
  ggplot(aes(x = popularity, y = album,
             shape = as.factor(is_taylors_version),
             alpha = danceability)) + 
  geom_point(size = 6) 
```

```r
                                                                                  #
                                                                                  #
                                                                                  #
                                                                                  #
```

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-119-1.png" width="1080" /&gt;
---

```r
ts %&gt;% 
  ggplot(aes(x = popularity, y = album,
             shape = as.factor(is_taylors_version),
             alpha = danceability)) + 
  geom_point(size = 6) +
  scale_shape_manual(values = c(15, 16)) 
```

```r
                                                                                  #
                                                                                  #
                                                                                  #
```

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-121-1.png" width="1080" /&gt;
---

```r
ts %&gt;% 
  ggplot(aes(x = popularity, y = album,
             shape = as.factor(is_taylors_version),
             alpha = danceability)) + 
  geom_point(size = 6) +
  scale_shape_manual(values = c(15, 16)) +
  theme_minimal(base_size = 20) 
```

```r
                                                                                  #
                                                                                  #
```

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-123-1.png" width="1080" /&gt;
---

```r
ts %&gt;% 
  ggplot(aes(x = popularity, y = album,
             shape = as.factor(is_taylors_version),
             alpha = danceability)) + 
  geom_point(size = 6) +
  scale_shape_manual(values = c(15, 16)) +
  theme_minimal(base_size = 20) + 
  theme(legend.position = "bottom") 
```

```r
                                                                                  #
```

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-125-1.png" width="1080" /&gt;


---
### Statistical summaries
So far, we've only seen **individual geoms**, where there is a graphical object drawn for each observation (e.g. `geom_point()` draws one point per row)

A **collective geom** displays multiple observations with one geometric object. They are often used to display grouped summary statistics (e.g. the average popularity by album) or variable distributions through boxplots or histograms/densities. 

.pull-left[
&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-126-1.png" width="576" /&gt;
]
.pull-right[

```r
ts %&gt;% 
  # Create summary statistic
  group_by(album) %&gt;% 
  summarise(popularity = 
              mean(popularity)) %&gt;% 
  # Plot
  ggplot(aes(x = album, 
             y = popularity)) +
  geom_bar(stat = "identity") + 
  # Rotate axis labels 
  theme(axis.text.x = 
          element_text(angle = -40, 
                       vjust = 1, 
                       hjust = 0))   
```
]
---

### Statistical summaries
So far, we've only seen **individual geoms**, where there is a graphical object drawn for each observation (e.g. `geom_point()` draws one point per row)

A **collective geom** displays multiple observations with one geometric object. They are often used to display grouped summary statistics (e.g. the average popularity by album) or variable distributions through boxplots or histograms/densities. 

.pull-left[
&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-128-1.png" width="576" /&gt;

]
.pull-right[

```r
ts %&gt;% 
  filter(!is.na(album)) %&gt;% 
  ggplot(aes(x = album, 
             y = popularity)) +
  geom_violin(fill = "lightblue",
              alpha = 0.5) + 
  geom_boxplot(width = .1,
               alpha = 0.4) 
```
]
---
## HOW TO CHOOSE THE RIGHT PLOT?
- **Do you want to see all the observations or summarize the data?**

- **Are your x and y categorical or continuous?** See the recommendations in the [ggplot2 cheatsheet](https://github.com/rstudio/cheatsheets/blob/main/data-visualization.pdf) or this [decision tree by Yan Holtz &amp; Conor Healy](https://www.data-to-viz.com/)

--

&lt;br&gt; 
Look into visualization galleries: 
- [The R graph ghallery](https://r-graph-gallery.com/) for examples of use cases and inspiration on aesthetics

- [50 ggplot2 visualizations with R code](http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html)

- Examples from economics research from DIME Analytics [Econ Visual Library in R](https://worldbank.github.io/r-econ-visual-library/index.html) and [Stata](https://worldbank.github.io/stata-visual-library/)

&lt;br&gt; 
--
 **BEST RESOURCE** for everything related to ``ggpplot()`
- [ggplot2: Elegant Graphics for Data Analysis by Haldey Wickham](https://ggplot2-book.org/).

---



---

### GRAPHICAL EXCELLENCE 
.greenhead[4 qualities of great visualizations]

.nunito[**1. HONEST**]
&lt;img src="./inputs/02_tesla-netflix-stock.png" width="50%" style="display: block; margin: auto;" /&gt;
--

Being careless with scales and axes is dangerous 
  - Zooming or unzooming the graphs can be very misleading. Start your axis at 0 (most of the time).
  - Double axes can say whatever you want them to say. Plot things on the same scale.



---
.greenhead[4 qualities of great visualizations]

.nunito[**2. FUNCTIONAL**]

- Your graph should convey information right but also **help the audience interpret the data correctly** - 
- It should be understood without additional context (label axes and add proper legends)
.pull-left[
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;img src="./inputs/02_music-pie.png" width="100%" style="display: block; margin: auto;" /&gt;
]

.pull-right[
&lt;img src="./inputs/02_music-slope.png" width="60%" style="display: block; margin: auto;" /&gt;
]

---



---


.greenhead[4 qualities of great visualizations]

.nunito[**3. BEAUTIFUL**]

- Your graph should be attractive and **‚ú®aesthetically pleasing‚ú®**. Declutter!  

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-134-1.png" width="1440" style="display: block; margin: auto;" /&gt;
---
.greenhead[4 qualities of great visualizations]

.nunito[**3. BEAUTIFUL**]

- Your graph should be attractive and **‚ú®aesthetically pleasing‚ú®**. Declutter!  

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-135-1.png" width="1440" style="display: block; margin: auto;" /&gt;

---

.greenhead[4 qualities of great visualizations]

.nunito[**4. INSIGHTFUL**]
- A graphic should reveal evidence that we would have a hard time seeing otherwise. The purpose of visualization is insight, not pictures.
- From the creators of "*meetings that could have been an e-mail*", we have: "*graphs that could have been a simple table or sentence*" 

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-136-1.png" width="576" style="display: block; margin: auto;" /&gt;

---

###HOMEWORK
Submit using [this](https://classroom.github.com/a/VrRecub6) link
- Use the `02_playfair-wages-wheat,csv` dataset and  and replicate this graph as best as you can using `ggplot()`
&lt;img src="inputs/playfair-wages-wheat.jpeg" width="50%" style="display: block; margin: auto;" /&gt;
  - üÜó OK: Plotting wheat prices, wages and the timeline of English rulers in the right geoms and colors
  - üëçüèΩ Great: Getting the axes (you might need `dup_axis()`) and the overall appearance of the geoms as similar as you can, as well as including the annotation in the middle of the graph ("Chart showing...")
  - ü§© Amazing: Adding the label over the wages series ("Weekly wages of a good mechanic"), customizing the appearance of the grid and including the labels of the English rulers 
  
---


### SLIDES THAT DIDN'T MAKE THE CUT

- Axes can be modified with **scale functions**. The following parameters can be specified:
  - `name` the label of the axis
  - `limits` where the axis starts and ends
  - `breaks` where to put ticks and values on the axis 
  
.pull-left[

```r
wid %&gt;% 
  ggplot(aes(inc_head, top1)) +
  geom_point() +
  
#  
```
]
.pull-right[

```r
wid %&gt;% 
  ggplot(aes(inc_head, top1)) +
  geom_point() +
  scale_x_continuous() + 
  scale_y_continuous()
```
]



---
## Axes

```r
wid %&gt;% 
  ggplot(aes(inc_head, top1)) +
  geom_point() 

                                                      #
```
&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-141-1.png" width="60%" /&gt;
---
## Axes

```r
wid %&gt;% 
  ggplot(aes(inc_head, top1)) +
  geom_point() +
  scale_x_continuous(name = "Income per adult",
                     limits = c(0, 150000)) + 
  scale_y_continuous(name = "Share of income among top 1%")
```

&lt;img src="02_data-visualization_files/figure-html/unnamed-chunk-142-1.png" width="60%" /&gt;


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightLines": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
